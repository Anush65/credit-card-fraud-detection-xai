<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Credit Card Fraud Detection</h1>
            <p>Advanced Machine Learning & Explainable AI Module</p>
        </header>

        <main>
            <section class="prediction-card">
                <h2>Predict Transaction</h2>
                <button type="button" class="autofill-btn" onclick="fillFraudSample()">Auto-fill Fraud Case</button>
                <button type="button" class="autofill-btn" onclick="fillNormalSample()">Auto-fill Normal Case</button>
                
                <form id="predictionForm">
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="Time">Time (sec)</label>
                            <input type="number" id="Time" name="Time" required>
                        </div>
                        <div class="input-group">
                            <label for="Amount">Amount ($)</label>
                            <input type="number" step="0.01" id="Amount" name="Amount" required>
                        </div>
                        <div class="input-group">
                            <label for="V4">V4</label>
                            <input type="number" step="0.0001" id="V4" name="V4" required>
                        </div>
                        <div class="input-group">
                            <label for="V10">V10</label>
                            <input type="number" step="0.0001" id="V10" name="V10" required>
                        </div>
                        <div class="input-group">
                            <label for="V12">V12</label>
                            <input type="number" step="0.0001" id="V12" name="V12" required>
                        </div>
                        <div class="input-group">
                            <label for="V14">V14</label>
                            <input type="number" step="0.0001" id="V14" name="V14" required>
                        </div>
                        <div class="input-group">
                            <label for="V17">V17</label>
                            <input type="number" step="0.0001" id="V17" name="V17" required>
                        </div>
                        <div class="input-group">
                            <label for="V18">V18</label>
                            <input type="number" step="0.0001" id="V18" name="V18" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="predict-btn">Analyze Transaction</button>
                </form>
            </section>

            <section id="resultSection" class="result-card hidden">
                <h2>Analysis Result</h2>
                <div id="resultContent">
                    <!-- Results will appear here -->
                </div>
            </section>
        </main>
        
        <footer>
            <p>Data Science Final Project - Mock</p>
        </footer>
    </div>

    <script>
        // Sample data for auto-fill (Approximate values for Fraud vs Normal)
        function fillFraudSample() {
            document.getElementById('Time').value = 406;
            document.getElementById('Amount').value = 0.00;
            document.getElementById('V4').value = 4.8;
            document.getElementById('V10').value = -5.6;
            document.getElementById('V12').value = -6.1;
            document.getElementById('V14').value = -6.8;
            document.getElementById('V17').value = -11.6;
            document.getElementById('V18').value = -4.5;
        }

        function fillNormalSample() {
            document.getElementById('Time').value = 1000;
            document.getElementById('Amount').value = 100.00;
            document.getElementById('V4').value = 0.5;
            document.getElementById('V10').value = 0.1;
            document.getElementById('V12').value = 0.2;
            document.getElementById('V14').value = 0.3;
            document.getElementById('V17').value = 0.1;
            document.getElementById('V18').value = 0.0;
        }

        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const response = await fetch('/predict', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            const resultDiv = document.getElementById('resultSection');
            const contentDiv = document.getElementById('resultContent');
            
            resultDiv.classList.remove('hidden');
            
            if (result.error) {
                contentDiv.innerHTML = `<p class="error">${result.error}</p>`;
            } else {
                let colorClass = result.result === 'Fraud' ? 'fraud-text' : 'clean-text';
                let explainHtml = '<h3>Top Influencing Features:</h3><ul>';
                result.top_features.forEach(f => {
                    explainHtml += `<li><strong>${f.feature}</strong>: Value ${f.value} (Importance: ${f.importance})</li>`;
                });
                explainHtml += '</ul>';

                contentDiv.innerHTML = `
                    <div class="main-result ${colorClass}">
                        ${result.result.toUpperCase()}
                    </div>
                    <div class="confidence">
                        Confidence: ${result.confidence}%
                    </div>
                    <div class="explanation">
                        ${explainHtml}
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
